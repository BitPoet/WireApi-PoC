# WireApi-PoC
Prototype for a ProcessWire API module for routing and API endpoints

This is a proof-of-concept implementation for a somewhat unified API endpoint class in ProcessWire.

## Status

alpha - just a prototype to play around run ideas against!

Don't even think of using this in production! The WireApi name may become a reserved class in
PW core at any time, and it will likely be something completely different from this!

## Goals
- Provide a neat routing syntax as concise as popular node.js routers or e.g. Laravel Routing
- Stick with familiar PW syntax / idioms
- Make use of builtin $sanitizer to validate route URLs and part values
- Allow handling of routes through functions, methods and PHP files


## A Bit of Prose
WireApi registers itself as $api API variable and thus is available as either $api,
wire('api') or $this->api inside Wire derived classes.

Routes all end in a custom page that calls $api->handleRequest();

You can theoretically have multiple API endpoints by creating multiple pages with
their own template.

A minimal template (e.g. /site/templates/api.php) would look like this:
```php
<?php namespace ProcessWire;

$api->handleRequest();
```

## Routes
Routes can be attached from almost anywhere, i.e. inside modules, site/ready.php
or the endpoint template file itself.

At a minimum, a route definition needs the HTTP verb(s) it handles (or 'ALL' as a
wildcard) and a handler, which can be a plain function, a class method or any valid
callable definition accepted by PHP, or the path to a PHP file, which lets you build
your own 'API template folders', e.g. /site/templates/apitemplates/.

### Examples
```PHP
// Simple GET route that populates the URL pattern paremeter 'number' and handles
// requests through an anonymous function.
$api->route(['GET'], '/api/test/{number}/', function($url, $values) { echo json_encode(['number' => $value['number']]); });

// More verbose POST route that populates $values['userid'], handles the request
// through the setUserData method of the current class and runs two checks to validate
// the path, the first through $sanitizer->unsignedInt, the second through a user defined
// function. It also verifies that the supplied Content-Type header is either text/json
// or application/json.
$api->route(['POST'], '/api/v1/user/{userid}/', $this, 'setUserData')
  ->check_unsignedInt('userid')
  ->check(function($url, $route, $check, $values) { return $values['userid'] < 999999; })
  ->ctype('text/json|application/json');

// Simple GET route using the shorthand method. The output is generated by rendering the
// apitemplates/userlist.php file.
$api->routeGET('/api/userlist/', 'apitemplates/userlist');
```

## License
Released under the terms of Mozilla Public License 2.0. See the LICENSE file in this repository.
